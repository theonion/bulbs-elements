{"version":3,"sources":["webpack:///bulbs-pinned-element.js","webpack:///./elements/bulbs-pinned-element/bulbs-pinned-element.js"],"names":["webpackJsonp","0","module","exports","__webpack_require__","_defaults","obj","defaults","keys","Object","getOwnPropertyNames","i","length","key","value","getOwnPropertyDescriptor","configurable","undefined","defineProperty","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","prototype","create","constructor","enumerable","writable","setPrototypeOf","_register","_util","BulbsPinnedElement","_BulbsHTMLElement","this","apply","arguments","attachedCallback","topOffsetAdjustment","parseInt","getAttribute","lastPosition","lastRailHeight","animationRequest","car","querySelector","document","createElement","moveChildren","appendChild","boundPositionCar","positionCar","bind","window","addEventListener","detachedCallback","removeEventListener","getBoundingRects","getRoundedBoundingClientRect","parent","parentElement","rail","isInView","boundingRects","InViewMonitor","isElementInViewport","_this2","cancelAnimationFrame","requestAnimationFrame","style","height","Math","abs","top","width","hasNewRailHeight","resetCarPosition","offset","getScrollOffset","y","scrollDirection","isScrollingDown","handleScrollDown","isScrollingUp","handleScrollUp","bottom","pinToRailBottom","innerHeight","newRailHeight","body","html","documentElement","documentHeight","max","scrollHeight","offsetHeight","clientHeight","pinToWindow","$","scrollTop","classList","remove","add","BulbsHTMLElement","default","registerElement","277"],"mappings":"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","file":"bulbs-pinned-element.js","sourcesContent":["webpackJsonp([18],{\n\n/***/ 0:\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _register = __webpack_require__(1);\n\t\n\tvar _util = __webpack_require__(196);\n\t\n\t__webpack_require__(277);\n\t\n\tfunction _defaults(obj, defaults) { var keys = Object.getOwnPropertyNames(defaults); for (var i = 0; i < keys.length; i++) { var key = keys[i]; var value = Object.getOwnPropertyDescriptor(defaults, key); if (value && value.configurable && obj[key] === undefined) { Object.defineProperty(obj, key, value); } } return obj; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass); }\n\t\n\tvar BulbsPinnedElement = function (_BulbsHTMLElement) {\n\t  _inherits(BulbsPinnedElement, _BulbsHTMLElement);\n\t\n\t  function BulbsPinnedElement() {\n\t    _classCallCheck(this, BulbsPinnedElement);\n\t\n\t    return _possibleConstructorReturn(this, _BulbsHTMLElement.apply(this, arguments));\n\t  }\n\t\n\t  BulbsPinnedElement.prototype.attachedCallback = function attachedCallback() {\n\t\n\t    this.topOffsetAdjustment = parseInt(this.getAttribute('offset-top-px') || 0, 10);\n\t    this.lastPosition = 0;\n\t    this.lastRailHeight = 0;\n\t    this.animationRequest = null;\n\t\n\t    var car = this.querySelector('bulbs-pinned-element-car');\n\t    if (car) {\n\t      this.car = car;\n\t    } else {\n\t      this.car = document.createElement('bulbs-pinned-element-car');\n\t      (0, _util.moveChildren)(this, this.car);\n\t      this.appendChild(this.car);\n\t    }\n\t\n\t    this.boundPositionCar = this.positionCar.bind(this);\n\t\n\t    window.addEventListener('scroll', this.boundPositionCar);\n\t\n\t    this.boundPositionCar();\n\t  };\n\t\n\t  BulbsPinnedElement.prototype.detachedCallback = function detachedCallback() {\n\t    window.removeEventListener('scroll', this.boundPositionCar);\n\t  };\n\t\n\t  BulbsPinnedElement.prototype.getBoundingRects = function getBoundingRects() {\n\t\n\t    return {\n\t      car: (0, _util.getRoundedBoundingClientRect)(this.car),\n\t      parent: (0, _util.getRoundedBoundingClientRect)(this.parentElement),\n\t      rail: (0, _util.getRoundedBoundingClientRect)(this)\n\t    };\n\t  };\n\t\n\t  BulbsPinnedElement.prototype.isInView = function isInView(boundingRects) {\n\t    return _util.InViewMonitor.isElementInViewport(this, boundingRects.rail);\n\t  };\n\t\n\t  BulbsPinnedElement.prototype.positionCar = function positionCar() {\n\t    var _this2 = this;\n\t\n\t    if (this.animationRequest) {\n\t      cancelAnimationFrame(this.animationRequest);\n\t    }\n\t    this.animationRequest = requestAnimationFrame(function () {\n\t      _this2.animationRequest = null;\n\t\n\t      var boundingRects = _this2.getBoundingRects();\n\t\n\t      _this2.style.height = boundingRects.parent.height - Math.abs(boundingRects.parent.top - boundingRects.rail.top) + 'px';\n\t      _this2.style.width = boundingRects.parent.width + 'px';\n\t\n\t      if (_this2.hasNewRailHeight(boundingRects)) {\n\t        _this2.resetCarPosition();\n\t      }\n\t\n\t      var offset = (0, _util.getScrollOffset)();\n\t\n\t      if (offset.y > _this2.lastPosition) {\n\t        _this2.scrollDirection = 'down';\n\t      } else if (offset.y < _this2.lastPosition) {\n\t        _this2.scrollDirection = 'up';\n\t      } else {\n\t        _this2.scrollDirection = null;\n\t      }\n\t\n\t      _this2.lastPosition = offset.y;\n\t\n\t      if (_this2.isInView(boundingRects)) {\n\t        if (_this2.isScrollingDown()) {\n\t          _this2.handleScrollDown(boundingRects);\n\t        } else if (_this2.isScrollingUp()) {\n\t          _this2.handleScrollUp(boundingRects);\n\t        }\n\t      } else if (boundingRects.parent.bottom <= 0) {\n\t        _this2.pinToRailBottom();\n\t      } else if (boundingRects.parent.top >= window.innerHeight) {\n\t        _this2.resetCarPosition();\n\t      }\n\t    });\n\t  };\n\t\n\t  BulbsPinnedElement.prototype.isScrollingUp = function isScrollingUp() {\n\t    return this.scrollDirection === 'up';\n\t  };\n\t\n\t  BulbsPinnedElement.prototype.isScrollingDown = function isScrollingDown() {\n\t    return this.scrollDirection === 'down';\n\t  };\n\t\n\t  BulbsPinnedElement.prototype.hasNewRailHeight = function hasNewRailHeight(boundingRects) {\n\t    var newRailHeight = false;\n\t\n\t    if (boundingRects.rail.height !== this.lastRailHeight) {\n\t      newRailHeight = true;\n\t      this.lastRailHeight = boundingRects.rail.height;\n\t    }\n\t\n\t    return newRailHeight;\n\t  };\n\t\n\t  BulbsPinnedElement.prototype.handleScrollDown = function handleScrollDown(boundingRects) {\n\t    var body = document.body;\n\t    var html = document.documentElement;\n\t    var documentHeight = Math.max(body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight);\n\t\n\t    if (boundingRects.rail.bottom <= boundingRects.car.bottom) {\n\t      this.pinToRailBottom();\n\t    } else if (boundingRects.rail.top - this.topOffsetAdjustment <= 0) {\n\t      this.pinToWindow();\n\t    } else if ($(window).scrollTop() >= documentHeight - window.innerHeight) {\n\t      this.pinToRailBottom();\n\t    }\n\t  };\n\t\n\t  BulbsPinnedElement.prototype.handleScrollUp = function handleScrollUp(boundingRects) {\n\t    var rail = boundingRects.rail;\n\t    var car = boundingRects.car;\n\t\n\t    if (rail.top >= car.top) {\n\t      this.resetCarPosition();\n\t    } else if ($(window).scrollTop() === 0) {\n\t      this.resetCarPosition();\n\t    } else if (rail.bottom - car.height - this.topOffsetAdjustment >= 0) {\n\t      this.pinToWindow();\n\t    }\n\t  };\n\t\n\t  BulbsPinnedElement.prototype.resetCarPosition = function resetCarPosition() {\n\t    this.car.classList.remove('pinned', 'pinned-bottom');\n\t\n\t    this.car.style.bottom = '';\n\t    this.car.style.top = 0;\n\t  };\n\t\n\t  BulbsPinnedElement.prototype.pinToRailBottom = function pinToRailBottom() {\n\t    this.car.classList.remove('pinned');\n\t    this.car.classList.add('pinned-bottom');\n\t\n\t    this.car.style.bottom = 0;\n\t    this.car.style.top = '';\n\t  };\n\t\n\t  BulbsPinnedElement.prototype.pinToWindow = function pinToWindow() {\n\t    this.car.classList.remove('pinned-bottom');\n\t    this.car.classList.add('pinned');\n\t\n\t    this.car.style.bottom = '';\n\t    this.car.style.top = this.topOffsetAdjustment + 'px';\n\t  };\n\t\n\t  return BulbsPinnedElement;\n\t}(_register.BulbsHTMLElement);\n\t\n\texports.default = BulbsPinnedElement;\n\t\n\t\n\t(0, _register.registerElement)('bulbs-pinned-element', BulbsPinnedElement);\n\n/***/ }),\n\n/***/ 277:\n/***/ (function(module, exports) {\n\n\t// removed by extract-text-webpack-plugin\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// bulbs-pinned-element.js","import {\n  registerElement,\n  BulbsHTMLElement,\n} from 'bulbs-elements/register';\nimport {\n  InViewMonitor,\n  getRoundedBoundingClientRect,\n  getScrollOffset,\n  moveChildren,\n} from 'bulbs-elements/util';\nimport './bulbs-pinned-element.scss';\n\nexport default class BulbsPinnedElement extends BulbsHTMLElement {\n\n  attachedCallback () {\n\n    this.topOffsetAdjustment = parseInt(this.getAttribute('offset-top-px') || 0, 10);\n    this.lastPosition = 0;\n    this.lastRailHeight = 0;\n    this.animationRequest = null;\n\n    let car = this.querySelector('bulbs-pinned-element-car');\n    if (car) {\n      this.car = car;\n    }\n    else {\n      this.car = document.createElement('bulbs-pinned-element-car');\n      moveChildren(this, this.car);\n      this.appendChild(this.car);\n    }\n\n    this.boundPositionCar = this.positionCar.bind(this);\n\n    window.addEventListener('scroll', this.boundPositionCar);\n\n    this.boundPositionCar();\n  }\n\n  detachedCallback () {\n    window.removeEventListener('scroll', this.boundPositionCar);\n  }\n\n  getBoundingRects () {\n\n    return {\n      car: getRoundedBoundingClientRect(this.car),\n      parent: getRoundedBoundingClientRect(this.parentElement),\n      rail: getRoundedBoundingClientRect(this),\n    };\n  }\n\n  isInView (boundingRects) {\n    return InViewMonitor.isElementInViewport(this, boundingRects.rail);\n  }\n\n  positionCar () {\n    if(this.animationRequest) {\n      cancelAnimationFrame(this.animationRequest);\n    }\n    this.animationRequest = requestAnimationFrame(() => {\n      this.animationRequest = null;\n\n      const boundingRects = this.getBoundingRects();\n\n      this.style.height = `${boundingRects.parent.height - Math.abs(boundingRects.parent.top - boundingRects.rail.top)}px`;\n      this.style.width = `${boundingRects.parent.width}px`;\n\n      if (this.hasNewRailHeight(boundingRects)) {\n        this.resetCarPosition();\n      }\n\n      const offset = getScrollOffset();\n\n      if (offset.y > this.lastPosition) {\n        this.scrollDirection = 'down';\n      }\n      else if (offset.y < this.lastPosition) {\n        this.scrollDirection = 'up';\n      }\n      else {\n        this.scrollDirection = null;\n      }\n\n      this.lastPosition = offset.y;\n\n      if (this.isInView(boundingRects)) {\n        if(this.isScrollingDown()) {\n          this.handleScrollDown(boundingRects);\n        }\n        else if (this.isScrollingUp()) {\n          this.handleScrollUp(boundingRects);\n        }\n      }\n      else if (boundingRects.parent.bottom <= 0) {\n        this.pinToRailBottom();\n      }\n      else if (boundingRects.parent.top >= window.innerHeight) {\n        this.resetCarPosition();\n      }\n    });\n  }\n\n  isScrollingUp () {\n    return this.scrollDirection === 'up';\n  }\n\n  isScrollingDown () {\n    return this.scrollDirection === 'down';\n  }\n\n  hasNewRailHeight (boundingRects) {\n    let newRailHeight = false;\n\n    if (boundingRects.rail.height !== this.lastRailHeight) {\n      newRailHeight = true;\n      this.lastRailHeight = boundingRects.rail.height;\n    }\n\n    return newRailHeight;\n  }\n\n  handleScrollDown (boundingRects) {\n    const body = document.body;\n    const html = document.documentElement;\n    const documentHeight = Math.max(\n      body.scrollHeight,\n      body.offsetHeight,\n      html.clientHeight,\n      html.scrollHeight,\n      html.offsetHeight,\n    );\n\n    if (boundingRects.rail.bottom <= boundingRects.car.bottom) {\n      this.pinToRailBottom();\n    }\n    else if (boundingRects.rail.top - this.topOffsetAdjustment <= 0) {\n      this.pinToWindow();\n    }\n    else if ($(window).scrollTop() >= documentHeight - window.innerHeight) {\n      this.pinToRailBottom();\n    }\n  }\n\n  handleScrollUp (boundingRects) {\n    const rail = boundingRects.rail;\n    const car = boundingRects.car;\n\n    if (rail.top >= car.top) {\n      this.resetCarPosition();\n    }\n    else if ($(window).scrollTop() === 0) {\n      this.resetCarPosition();\n    }\n    else if (rail.bottom - car.height - this.topOffsetAdjustment >= 0) {\n      this.pinToWindow();\n    }\n  }\n\n  resetCarPosition () {\n    this.car.classList.remove('pinned', 'pinned-bottom');\n\n    this.car.style.bottom = '';\n    this.car.style.top = 0;\n  }\n\n  pinToRailBottom () {\n    this.car.classList.remove('pinned');\n    this.car.classList.add('pinned-bottom');\n\n    this.car.style.bottom = 0;\n    this.car.style.top = '';\n  }\n\n  pinToWindow () {\n    this.car.classList.remove('pinned-bottom');\n    this.car.classList.add('pinned');\n\n    this.car.style.bottom = '';\n    this.car.style.top = `${this.topOffsetAdjustment}px`;\n  }\n}\n\nregisterElement('bulbs-pinned-element', BulbsPinnedElement);\n\n\n\n\n// WEBPACK FOOTER //\n// ./elements/bulbs-pinned-element/bulbs-pinned-element.js"],"sourceRoot":""}